(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"ab4c1c13-e80f-4b5b-8ab2-b86d553f5ef0","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function n(){return fetch(e.baseUrl+"/cards",{headers:e.headers}).then(t)}function o(){return fetch(e.baseUrl+"/users/me",{headers:e.headers}).then(t)}var r=document.querySelector("#card-template").content,c="f84ecf6df16b9c52acf5165f";function a(n,o,a){var u=r.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__title"),d=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-count"),f=n._id;return u.id=f,i.alt=n.name,l.textContent=n.name,i.src=n.link,p.textContent=n.likes.length,n.owner._id!=c?s.style.display="none":s.addEventListener("click",(function(){o(f)})),d.addEventListener("click",(function(){var n,o,r;o=p,r=f,(n=d).classList.contains("card__like-button_is-active")?function(n){return fetch(e.baseUrl+"/cards/likes/"+n,{method:"DELETE",headers:e.headers}).then(t)}(r).then((function(e){n.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(n){return fetch(e.baseUrl+"/cards/likes/"+n,{method:"PUT",headers:e.headers}).then(t)}(r).then((function(e){n.classList.add("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),i.addEventListener("click",a),u}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s),document.addEventListener("mousedown",l)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s),document.removeEventListener("mousedown",l)}function s(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function l(e){e.target.classList.contains("popup_is-opened")&&i(document.querySelector(".popup_is-opened"))}function d(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function p(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.textContent="",r.classList.remove(o)}function f(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){p(e,n,t.inputErrorClass,t.errorClass)})),o.classList.add(t.disabledButtonClass)}var m=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),y=document.forms["edit-profile"],v=y.elements.name,b=y.elements.description,S=y.querySelector(".popup__button"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_image"),L=document.querySelector(".popup__image"),k=document.querySelector(".popup__caption"),x=document.querySelectorAll(".popup__close"),U=document.querySelector(".popup_type_new-card"),A=document.querySelector(".profile__add-button"),w=document.forms["new-place"],T=w.elements["place-name"],B=w.elements.link,D=w.querySelector(".popup__button"),P=[n,o],N=document.querySelector(".popup_type_delete-card"),O=document.forms["delete-card"],j=(O.querySelector(".popup__button"),document.querySelector(".popup_type_edit-image")),J=document.querySelector(".profile__image-button"),M=document.forms["edit-image"],H=M.elements.link,I=M.querySelector(".popup__button"),V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",disabledButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function z(e){L.src=e.target.src,L.alt=e.target.alt,k.textContent=e.target.alt,u(E)}function F(e){i(e.target.closest(".popup"))}function G(e){O.dataset.id=e,u(N)}Promise.all(P).then((function(){o().then((function(e){q.textContent=e.name,g.textContent=e.about,C.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.log(e)})),n().then((function(e){e.forEach((function(e){return function(e,t){var n=a(e,G,z);t.append(n)}(e,m)}))})).catch((function(e){console.log(e)}))})),_.addEventListener("click",(function(){f(y,V),v.value=q.textContent,b.value=g.textContent,u(h)})),x.forEach((function(e){e.addEventListener("click",F)})),y.addEventListener("submit",(function(n){var o,r;n.preventDefault(),S.textContent="Сохранение...",(o=v.value,r=b.value,fetch(e.baseUrl+"/users/me",{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(t)).then((function(e){console.log(e),q.textContent=v.value,g.textContent=b.value,i(h)})).catch((function(e){console.log(e)})).finally((function(){S.textContent="Сохранить"}))})),A.addEventListener("click",(function(){f(w,V),w.reset(),u(U)})),w.addEventListener("submit",(function(n){!function(n){var o,r;n.preventDefault(),D.textContent="Сохранение...",(o=T.value,r=B.value,fetch(e.baseUrl+"/cards",{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:r})}).then(t)).then((function(e){m.prepend(a(e,G,z)),i(U)})).catch((function(e){console.log(e)})).finally((function(){D.textContent="Сохранить"}))}(n)})),O.addEventListener("submit",(function(n){n.preventDefault();var o=O.dataset.id;(function(n){return fetch(e.baseUrl+"/cards/"+n,{method:"DELETE",headers:e.headers}).then(t)})(o).then((function(){document.querySelector("[id='".concat(o,"']")).remove(),i(N)})).catch((function(e){console.log(e)}))})),J.addEventListener("click",(function(){M.reset(),f(M,V),u(j)})),M.addEventListener("submit",(function(n){var o;n.preventDefault(),I.textContent="Сохранение...",(o=H.value,fetch(e.baseUrl+"/users/me/avatar",{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(e){C.style.backgroundImage="url('".concat(e.avatar,"')"),i(j)})).catch((function(e){console.log(e)})).finally((function(){I.textContent="Сохранить"}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll("".concat(t))),u=e.querySelector(n);d(a,u,o),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismaatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),c.textContent=r,c.classList.add(o)}(e,t,n,o,t.validationMessage)}(e,t,r,c),d(a,u,o)}))}))}(t,e.inputSelector,e.submitButtonSelector,e.disabledButtonClass,e.inputErrorClass,e.errorClass)}))}(V)})();